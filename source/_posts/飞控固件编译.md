---
title: 飞控固件编译
date: 2017-03-02 10:28:17
tags: [UAV, Ubuntu, Compile]
categories: UAV
---

关于PX4以及APM飞控固件的编译问题
<!-- more -->

# PX4
## Installation
To compile the code, **CMake** and **GCC** are necessary.
### CMake
    sudo add-apt-repository ppa:george-edison55/cmake-3.x -y
    sudo apt-get update
    sudo apt-get install cmake -y
### GCC
    sudo add-apt-repository ppa:terry.guo/gcc-arm-embedded -y
    sudo apt-get update
    sudo apt-get install gcc-arm-none-eabi -y

## NuttX based hardware
Ubuntu comes with a serial modem manager which interferes heavily with any robotics related use of a serial port (or USB serial). It can deinstalled without side effects:

    sudo apt-get remove modemmanager

## Permission Setup
Because the "tty" belong to the group "dialout", to operate the pixhawk the user needs to be added to the group "dialout":

    sudo usermod -a -G dialout $USER

And then you have to logout and login again, as this is only changed after a new login.

## Compiling on the Console
We default to '~/src/Firmware' and clone the upstream repository. 

    mkdir -p ~/src
    cd ~/src
    git clone https://github.com/PX4/Firmware.git
    cd Firmware
    git submodule update --init --recursive
    make px4fmu-v2_default

## Upload to the pixhawk
By appending 'upload' to these commands the compiled binary will be uploaded via USB to the pixhawk:

    make px4fmu-v2_default upload

A successful run will end with this output:

    Erase  : [====================] 100.0%
    Program: [====================] 100.0%
    Verify : [====================] 100.0%
    Rebooting.

    [100%] Built target upload
# APM
**If you have configured the environment for PX4, you can clone the APM code and compile it directly.**
## Installation
There is a script to config the environment easily， what we need to do is just clone from ardupilot and run this script:

    git clone https://github.com/diydrones/ardupilot.git
    ardupilot/Tools/scripts/install-prereqs-ubuntu.sh -y

Reload the path (log-out and log-in to make permanent):

    . ~/.profile

## Compiling on the Console
Build for Copter

    cd ardupilot/ArduCopter
    make px4-v2

## Loading firmware
To load the firmware onto the board use

    make px4-v1-upload

After it says “waiting for bootloader” plugin your Pixhawk on USB.

